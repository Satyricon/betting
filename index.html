<div class="col-md-12 thirdrow">
    <div style="display:inline-block;">
        <textarea rows="50" cols="60" id="json"></textarea>
    </div>
    <div style="display:inline-block;">
        <textarea rows="50" cols="60" id="rendered"></textarea>
    </div>
</div>
<button type="button" onclick="render()">Render</button>
<script>
  function render() {
    let bets = document.getElementById("json");
    let betsJson = JSON.parse(bets.value);
    let rendered = document.getElementById("rendered");

    let textArray = betsJson.map(bet => {
      var d = new Date(bet.date)

      let str = d.getDate()+"."+d.getMonth() + "\r" +
        bet.members.join(" - ") + "\r" +
        "(" + bet.sportName + ") " +
        isxod(bet) + " кф " + koeff(bet.V) + "\r"
        
      return str;
    })
    let text = textArray.join("\r");
    text += "\rОбщий коэффициент " + koeff(betsJson.reduce((acc, cur) => acc *= cur.V, 1))
    rendered.value = text
  }

  function koeff(e) {
    if (!e || 1 === Number(e) || "-" === e) return "-";
    if (e < 10) return e.toFixed(3).slice(0, -1);
    if (e >= 100) return Math.floor(e);
    var t = Math.floor(100 * (e % 1).toFixed(2));
    0 === t && (t += "0");
    var n = (parseInt(e) + "." + t).slice(0, -1);
    return "." === n[n.length - 1] ? n.slice(0, -1) : n;
  }

  function isxod(bet) {
    let isxod;
      let index = bet.members.indexOf(bet.R);
      if (index >= 0) {
        if(bet.Free.toLowerCase().includes("фора")) {
          isxod = bet.Free.replace("фора", "Ф" + (index+1))
        }
        else
          isxod = "П" + (index+1)
      }
      else {
        if (bet.R.toLowerCase() == "ничья") {
          isxod = "Х"
        } else if (bet.R.toLowerCase() == "больше") {
          isxod = "ТБ"
        } else if (bet.R.toLowerCase() == "меньше") {
          isxod = "ТМ"
        }
      }
      return isxod
  }
</script>
